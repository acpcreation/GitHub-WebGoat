# Security Test Vulnerability Documentation

## Overview
This document describes the intentional security vulnerability introduced for testing security tooling.

## Location
**File**: `src/main/java/org/owasp/webgoat/container/controller/UserProfileController.java`

## Vulnerability Type
**SQL Injection (CWE-89)**

## Endpoints Affected

### 1. `/api/user/profile`
- **Method**: GET
- **Parameter**: `username`
- **Vulnerability**: Direct string concatenation in SQL query
- **Exploit Example**: 
  ```
  GET /api/user/profile?username=admin' OR '1'='1
  ```

### 2. `/api/user/search`
- **Method**: GET
- **Parameter**: `searchTerm`
- **Vulnerability**: Unsanitized input in LIKE clause
- **Exploit Example**:
  ```
  GET /api/user/search?searchTerm=%' UNION SELECT password, username FROM users --
  ```

## Technical Details

### Vulnerable Code Pattern
```java
String query = "SELECT * FROM users WHERE username = '" + username + "'";
```

This pattern is vulnerable because:
1. User input is directly concatenated into the SQL query
2. No input validation or sanitization is performed
3. No parameterized queries or prepared statements are used
4. Special SQL characters are not escaped

## Security Tools That Should Detect This

- **Static Analysis (SAST)**:
  - SonarQube
  - Checkmarx
  - Fortify
  - FindSecBugs
  - SpotBugs with security plugins
  
- **Dynamic Analysis (DAST)**:
  - OWASP ZAP
  - Burp Suite
  - SQLMap
  
- **Dependency Scanners**:
  - May flag database connection patterns

## Expected Detection

Security tools should report:
- **Severity**: High/Critical
- **CWE**: CWE-89 (SQL Injection)
- **OWASP**: A03:2021 - Injection
- **Line Numbers**: Lines where string concatenation occurs in SQL queries

## Remediation (For Reference)

The secure implementation would use PreparedStatement:

```java
// SECURE CODE (not implemented)
String query = "SELECT * FROM users WHERE username = ?";
PreparedStatement pstmt = connection.prepareStatement(query);
pstmt.setString(1, username);
ResultSet resultSet = pstmt.executeQuery();
```

## Testing Instructions

1. Run your security scanning tools against the codebase
2. Verify they detect the SQL injection vulnerabilities
3. Check for proper reporting of:
   - File location
   - Line numbers
   - Severity rating
   - Recommended fixes

## Removal Instructions

When testing is complete, remove or fix the vulnerability:
```bash
# Option 1: Delete the file
rm src/main/java/org/owasp/webgoat/container/controller/UserProfileController.java

# Option 2: Revert the commit
git revert <commit-hash>
```

## Important Notes

⚠️ **WARNING**: This is a deliberately insecure implementation for testing purposes only.

- Do NOT deploy this code to production
- Do NOT expose this endpoint to untrusted networks
- This is for security tooling validation only
- Remove this vulnerability after testing is complete

## Date Added
October 22, 2025

## Added By
Security Testing Initiative
